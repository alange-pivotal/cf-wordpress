function Modal_Projects(t){$(document).trigger("/modal-projects/init/",t),this.$el=t,this.dom()}Modal_Projects.prototype.board=function(){return boards[current_board_id]},Modal_Projects.prototype.dom=function(){var t=this;t.$el.on("show.bs.modal",function(){if(!t.board().current_user().has_cap("write"))return!1;t.board().project_update_counts();var r=$("#accordion-projects").empty(),e=t.board().record.status_records();for(var o in t.board().record.project_records){var a=t.board().record.project_records[o],n=kanban.templates[t.board().record.id()]["t-modal-project"].render({project:a,statuses:e});$(n).appendTo(r)}}),t.$el.on("hide.bs.modal",function(){$("#modal-projects-filter").val(""),$("#modal-projects-sort").attr("data-reverse","false"),$("#modal-projects-sort .glyphicon").hide().attr("class","glyphicon glyphicon-arrow-up").attr("data-class","glyphicon glyphicon-arrow-down")}),t.$el.on("click",".btn-project-delete",function(){if(confirm(kanban.text.project_delete_confirm)!==!0)return!1;var r=$(this),e=r.closest(".panel"),o=r.attr("data-id"),a=t.board().record.project_records[o],n={project:a,action:"delete_project",kanban_nonce:$("#kanban_nonce").val()};$.ajax({method:"POST",url:kanban.ajaxurl,data:n}).done(function(r){for(var a in t.board().record.tasks){var n=t.board().record.tasks[a];n.record.project_id==o&&n.project_save(0)}delete t.board().record.project_records[o],e.remove()})}),t.$el.on("focus",".project-title",function(){var t=$(this);t.data("orig",t.val())}),t.$el.on("keyup",".project-title",function(t){var r=$(this);if(13==t.keyCode)return r.trigger("blur"),!1;if(27==t.keyCode){var e=r.data("orig");return r.val(e).trigger("blur"),!1}}),t.$el.on("blur",".project-title",function(){var r=$(this),e=r.closest(".panel"),o=r.val(),a=r.attr("data-id"),n=t.board().record.project_records[a];n.title=o;var c={project:n,action:"save_project",kanban_nonce:$("#kanban_nonce").val()};$.ajax({method:"POST",url:kanban.ajaxurl,data:c}).done(function(r){$(".label-project-title",e).text(o);for(var n in t.board().record.tasks){var c=t.board().record.tasks[n];c.record.project_id==a&&c.project_save(a)}})}),t.$el.on("click",".btn-project-reset",function(){var t=$(this),r=t.closest(".panel-project"),e=$(".select-project-reset",r),o=r.attr("data-id"),a=e.val();if(""==a||""==o)return!1;var n={action:"reset_project",project_id:o,status_id:a,kanban_nonce:$("#kanban_nonce").val()};return $.ajax({method:"POST",url:kanban.ajaxurl,data:n}).done(function(t){kanban.updates_task()}),!1}),t.$el.on("click","#modal-project-new-btn",function(){var t=$("#modal-project-new-input").val();return""!=t&&(Project.prototype.add(Board.prototype.get_current_board_id(),t,function(){$("#modal-project-new-input").val(""),$("#modal-projects").modal("hide")}),!1)}),t.$el.on("keyup","#modal-projects-filter",function(){var t=$(this),r=t.val(),e=$.trim(r.toLowerCase()),o=$("#accordion-projects");return""==e?($(".panel-project:hidden",o).slideDown("fast"),!1):($(".panel-project",o).each(function(){var t=$(this),r=$(".label-project-title",t).text();$.trim(r.toLowerCase()).search(e)>-1?t.slideDown("fast"):t.is(":visible")&&t.slideUp("fast")}),!1)}),t.$el.on("click","#modal-projects-sort",function(){var t=$(this),r="true"===t.attr("data-reverse"),e=$("#accordion-projects"),o=e.find(".panel-project").get();o.sort(function(t,r){var e=$(t).find(".label-project-title").text().toUpperCase(),o=$(r).find(".label-project-title").text().toUpperCase();return e.localeCompare(o)}),$.each(o,function(t,r){e.append(r)}),r&&$(o).each(function(t,r){e.prepend(r)}),t.attr("data-reverse",r?"false":"true");var a=$(".glyphicon",t),n=a.attr("class"),c=a.attr("data-class");return a.attr("class",c).attr("data-class",n).show(),!1})};